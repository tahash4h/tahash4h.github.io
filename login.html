<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Login - Book Finder</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bungee"/>
    <script src="https://kit.fontawesome.com/6b90f3ba18.js" crossorigin="anonymous"></script>
    <!-- Add JWT Decode library -->
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <!-- Add Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async></script>
    <style>
        .user-profile {
            display: none;
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
        }
        .user-profile img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 10px;
        }
        .google-btn-wrapper {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .or-divider {
            text-align: center;
            margin: 20px 0;
            color: #718096;
            position: relative;
        }
        .or-divider::before,
        .or-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background-color: #e2e8f0;
        }
        .or-divider::before { left: 0; }
        .or-divider::after { right: 0; }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <a href="index.html">
                <h1>üìö Book Finder</h1>
            </a>
        </div>
        <nav>
            <a href="booksrec.html">Recommendations</a>
            <a href="ratings.html">Reviews</a>
            <a href="booklist.html">Book List</a>
            <a href="search.html">Search</a>
            <a href="contact.html">Contact</a>
        </nav>
        <div class="auth-buttons">
            <a href="login.html" class="btn btn-login">Login</a>
            <a href="signup.html" class="btn">Sign Up</a>
        </div>
        <div class="profile-container">
            <img src="" alt="Profile" class="profile-picture" id="headerProfilePic">
            <div class="profile-dropdown">
                <a href="#" class="profile-dropdown-item" id="signOutBtn">
                    <i class="fa-solid fa-sign-out-alt"></i>
                    Sign Out
                </a>
            </div>
        </div>
    </header>

    <main class="auth-container">
        <div class="auth-form-container">
            <h2>Welcome Back!</h2>
            
            <!-- Google Sign-In Button -->
            <div class="google-btn-wrapper">
                <div id="g_id_onload"
                     data-client_id="339815443597-is0vm4bnlgq6qh053hf3d2m8el05bhf6.apps.googleusercontent.com"
                     data-context="signin"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-shape="rectangular"
                     data-theme="outline"
                     data-text="signin_with"
                     data-size="large"
                     data-logo_alignment="left">
                </div>
            </div>

            <div class="or-divider">OR</div>

            <!-- Regular Login Form -->
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="username">
                        <i class="fa-solid fa-user"></i>
                        Username or Email
                    </label>
                    <input type="text" id="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">
                        <i class="fa-solid fa-lock"></i>
                        Password
                    </label>
                    <input type="password" id="password" required>
                </div>

                <div class="form-group checkbox">
                    <input type="checkbox" id="rememberme">
                    <label for="rememberme">Remember Me</label>
                </div>

                <button type="submit" class="auth-button">Log In</button>
                
                <p class="auth-link">Don't have an account? <a href="signup.html">Sign Up</a></p>
            </form>

            <!-- User Profile Section -->
            <div id="userProfile" class="user-profile">
                <img id="userImage" alt="Profile Picture">
                <h3 id="userName"></h3>
                <p id="userEmail"></p>
                <button onclick="signOut()" class="auth-button" style="margin-top: 10px;">Sign Out</button>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About Book Finder</h3>
                <p>Your ultimate destination for discovering new books and connecting with fellow readers.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="booksrec.html">Book Recommendations</a></li>
                    <li><a href="ratings.html">Book Reviews</a></li>
                    <li><a href="booklist.html">My Book List</a></li>
                    <li><a href="search.html">Search Books</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="social-links">
                    <a href="#" class="social-link">üìò Facebook</a>
                    <a href="#" class="social-link">üì∏ Instagram</a>
                    <a href="#" class="social-link">üê¶ Twitter</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Book Finder. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Handle Google Sign-In response
        function handleCredentialResponse(response) {
            try {
                // Decode the JWT token
                const decoded = jwt_decode(response.credential);
                
                // Store user data in localStorage
                const userData = {
                    name: decoded.name,
                    email: decoded.email,
                    picture: decoded.picture,
                    token: response.credential
                };
                localStorage.setItem('userData', JSON.stringify(userData));
                
                // Update UI
                displayUserProfile(userData);
            } catch (error) {
                console.error('Error handling Google Sign-In:', error);
                alert('An error occurred during sign-in. Please try again.');
            }
        }

        // Display user profile
        function displayUserProfile(userData) {
            document.querySelector('.auth-form').style.display = 'none';
            document.querySelector('.google-btn-wrapper').style.display = 'none';
            document.querySelector('.or-divider').style.display = 'none';
            
            const userProfile = document.getElementById('userProfile');
            const userImage = document.getElementById('userImage');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            
            userImage.src = userData.picture;
            userName.textContent = userData.name;
            userEmail.textContent = userData.email;
            userProfile.style.display = 'block';
        }

        // Sign out function
        function signOut() {
            localStorage.removeItem('userData');
            location.reload();
        }

        // Check if user is already logged in
        window.onload = function() {
            const userData = localStorage.getItem('userData');
            if (userData) {
                displayUserProfile(JSON.parse(userData));
            }
        };

        // Handle regular login form
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Add your regular login logic here
        });
    </script>
    <script src="auth-header.js"></script>
</body>
</html>